{%- macro expand_icon() -%}
<i class="icon-closed"></i>
{%- endmacro -%}

{%- macro json_pp(json_data) -%}
    <dl>
    {% for item in json_data.iteritems() recursive -%}
        {% if item[1] is defined and item[0] is defined %}
            <dt><span class="block-expander closed">{{ expand_icon() }} {{ item[0] }}</span></dt>
            <dd class="collapse">{{ json_looper(item[1], loop) }}</dd>
        {% else %}
            <li class="block-expander closed" style="clear: left">[{{ loop.index0 }}]
                <div class="collapse li">{{ json_looper(item, loop) }}</div>
            </li>
        {% endif %}
    {% endfor %}
    </dl>
{%- endmacro -%}

{%- macro json_looper(item, loop) -%}
    {%- if item is mapping -%}
        <dl>{{ loop(item.iteritems()) }}</dl>
    {%- elif item is iterable and item is not string -%}
        <ul>{{ loop(item) }}</ul>
    {%- else -%} 
        {{ item }}
    {%- endif -%}
{%- endmacro -%}

{%- macro expander_js() -%}
<script>
  function closeRegion($blockExpander) {
      $blockExpander
        .children('div.li').addClass('collapse').end()
        .parents('dt').next('dd').addClass('collapse'); 
      toggleBits($blockExpander);
  }

  function openRegion($blockExpander) {
      $blockExpander
        .children('div.li').removeClass('collapse').end()
        .parents('dt').next('dd').removeClass('collapse'); 
      toggleBits($blockExpander);
  }

  function toggleBits($base) {
      $base.toggleClass('closed open').children('i').toggleClass('icon-closed icon-open');
  }

  $('li').click(function() {
    $(this).children('.block-expander').click();
  });

  $('.block-expander').click(function(event) {
    event.stopPropagation();
    $this = $(this);
    if ($this.hasClass('closed')) {
        openRegion($this);
        if (event.altKey) {
            $this.children('div.li')
              .add($this.parents('dt').next('dd'))
              .find('.block-expander.closed').each(function() { openRegion($(this)) });
        }
    } else {
        closeRegion($this);
        if (event.altKey) {
            $this.children('div.li')
              .add($this.parents('dt').next('dd'))
              .find('.block-expander.open').each(function() { closeRegion($(this)) });
        }
    }
  });
</script>
{%- endmacro -%}

<!doctype html>
<html>
    <head>
       {% block head %}
           <title>{% block title %}{% endblock %} - ingestr</title>
           <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
           <style type="text/css">
               dl { margin: 0px; }
               ul { margin-bottom: 0px; }
               dt::after { content: ': ' }
               dt, dd { float: left; }
               dt { clear: left }
               dd { line-height: 20px; }
               li.closed { list-style-image: url('/static/images/closed.png') }
               li.open { list-style-image: url('/static/images/open.png') }
               div.li { margin-left: 10px }
               i.icon-closed, i.icon-open {
                   width: 7px;
                   height: 7px;
                   line-height: 20px;
                   display: inline-block;
                   background-position: 0px 0px;
                   vertical-align: baseline;
               }
               i.icon-closed { background-image: url('/static/images/closed.png'); }
               i.icon-open { background-image: url('/static/images/open.png'); }
               .block-expander, .json-expander { cursor: pointer; }
           </style>
       {% endblock %}
    </head>
    <body>
        <div class="container">
          <div class="content">
            <h1>Ingestr</h1>
            <form action="/" method="get">
              <div class="clearfix">
                <label for="id-query">Query:</label>
                <div class="input">
                  <input type="text" name="query" id="id-query" />
                </div>
              </div>
              <div class="actions">
                <input type="submit" class="btn primary" value="Search" />
              </div>
            </form>
            {% block content %}{% endblock %}
          </div>
    </div>
    <script src="/static/jquery/jquery-1.8.2.min.js"></script>
    {% block js %}{% endblock %}
    </body>
</html>
